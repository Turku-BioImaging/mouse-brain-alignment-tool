<!DOCTYPE html>
<html>
<head>
<title>USAGE.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="user-documentation">User Documentation</h1>
<p>Download a copy of the latest release through the <a href="https://github.com/Turku-BioImaging/mouse-brain-alignment-tool/releases">GitHub repository</a> hosted by Turku BioImaging. Download and extract the release ZIP file into a folder of your choice. After extraction, there should be three files present:</p>
<ul>
<li>preprocess-<em>version-number</em>.exe</li>
<li>analyze-<em>version-number</em>.exe</li>
<li>data.xlsx</li>
</ul>
<h2 id="module-1---preprocessing">Module 1 - Preprocessing</h2>
<p>First here: how to set up images and excel.</p>
<h3 id="input-data">Input data</h3>
<p>A single folder is required as input. This folder must contain any number of TIFF images and a single <em>data.xlsx</em> file. Images must use the extension <em>*.tif</em>, otherwise they will not be included in the preprocessing. The <em>data.xlsx</em> is an Excel workbook that must follow a particular format. It includes the folowing columns:</p>
<ul>
<li>image_filename</li>
<li>num_slides</li>
<li>num_animals</li>
<li>animal_left_name</li>
<li>animal_right_name</li>
</ul>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/screenshot-102249.png" alt="Example of Excel data file" style="width: 50%; height: auto;">
  <figcaption><em>Example of Excel data file</em></figcaption>
</figure>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/screenshot-102625.png" alt="Example contents of input folder" style="width: 50%; height: auto;">
  <figcaption><em>Example contents of input folder</em></figcaption>
</figure>
<p><br/><br/>
For every image, if the column <em>num_animals</em> has a value of <em>1</em>, then the columns <em>animal_left_name</em> and <em>animal_right_name</em> must be blank. If the column <em>num_animals</em> has a value of <em>2</em>, then the preprocessing tool assumes a column of slides in the input images to be from the same animal (see image below). A copy of the Excel template is located <a href="excel_template.xlsx">here</a>.</p>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/example_dataset_layout.png" alt="How the tool differentiates between animals" style="width: 20%; height: auto;">
  <figcaption><em>How the tool differentiates between animals</em></figcaption>
</figure>
<h3 id="expected-output">Expected output</h3>
<h3 id="usage">Usage</h3>
<p>Double-click on <strong>preprocess-0.2.2.exe</strong> to open the preprocessing interface (this can take up to a minute). After the preprocess window is open, select the source directory (the folder containing images and the prepared Excel sheet <em>data.xlsx</em>). Select the output directory, as where do you wish the preprocessed data to be saved to. Click run to start the preprocess.<br>
<strong>IMPORTANT:</strong> The Excel document should not be open while the preprocess app is running!</p>
<hr>
<img style="width: 320px; height: auto;" alt="preprocess_gui" src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/screenshot-preprocess.png">
<p>Select the directory where your images and data.xls file are. Select the folder where you want the preprocessed images to appear as output directory.
Depending on data size, the preprocess can take longer time. Process can be tracked from running log, where all processed images will be marked, as well as the completion of preprocessing.
In the output folder, there will be a separate folder for each image, with a name corresponding to image_filename. The folder will contain separate subfolders for each animal in the image. These subfolders will contain sections folder, the tiff folder that contains original .tif file as well as QC folder. Sections folder contains all the sections of the brain as separate .tif files, while QC (quality control) folder contains a PDF document with raw image, rotated slices and documented slices.</p>
<h2 id="module-2---analysis">Module 2 - Analysis</h2>
<p>This module provides a graphical interface where preprocessed ARG brain sections can be matched to anatomical atlas sections and their intensity analyzed. Regions-of-interest (ROIs) pertaining to specific brain regions from the anatomical atlas can be manually registered to fit the ARG image. Average intensities of individual ROIs can then be measured and saved in a data file.</p>
<p>There is no need for the user to analyze all image sections. Analyzed data is stored in a CSV data file that is automatically reloaded whenever the app is opened.</p>
<h3 id="input-data">Input data</h3>
<p>This module accepts input data generated from <em>Module 1 - Preprocessing</em>. A single folder named <em>sections</em> must be selected containing TIFF section images. Alternatively, the user can, within the <em>sections</em> folder, create subfolders where section TIFFs can be copied. These subfolders can be loaded invidividually into the app. NB! Choosing a higher level folder than the <em>sections</em> will result in an error message and the analysis module crashing, forcing the user to restart the module.</p>
<p><img src="./assets/docs/screenshot-input-data.png" style="width: 500px; height: auto;"></img><br>
<em>Example contents of sections folder used as input.</em></p>
<h3 id="expected-output">Expected output</h3>
<h3 id="usage">Usage</h3>
<p><img src="./assets/docs/screenshot-module-analysis.png" alt="Module 2 data selection interface" style="width: 320px; height: auto;"></img><br>
<em>Module 2 data selection interface</em></p>
<p>Select a <em>sections</em> folder to be analyzed and click <em>Continue</em> to open the image analysis graphical user interface. The module will automatically open the original source image with a box for analyzing background signal level. This is done simply by moving the box to an area without signal from a sample and clicking <em>Calculate background</em> on the right upper corner. The background signal value appears in the box under the button. The size and shape of the box for setting the background is freely adjustable.
After the background is set click <em>Start alignment</em> to start matching ROIs to individual brain slices. The background signal is automatically deducted from the analyzed ROIs in the results-file. NB! The background signal value is not recorded on the results-file.</p>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/setting_background.png" alt="Module 2 Image analysis interface for setting background" style="width: 50%; height: auto;">
  <figcaption><em>Module 2 Image analysis interface for setting background</em></figcaption>
</figure>
<p><br/><br/>
Next the sectioned sample brain slice image, ROI map and anatomical reference image are all displayed side by side. Using the slider at the bottom the user can toggle through the reference images and choose the best match for the sample brain slice. A reference image from the middle of the brain is displayed by default. Once the corresponding anatomical reference image for the sample brain slice image has been found, the ROIs are overlayed by clicking <em>Add ROIs / Reset</em>.</p>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/matching_ROI.png" alt="Matching ROIs / anatomical reference with the sample slice" style="width: 50%; height: auto;">
  <figcaption><em>Matching ROIs / anatomical reference with the sample slice</em></figcaption>
</figure>
<p><br/><br/>
The user can now move the ROIs to better match the sample. Using the layer control options on the upper left of the window, the ROIs can be freely moved (<em>Select shapes</em>, drag with mouse) and adjusted (<em>Select vertices</em>, drag blue dots with mouse). Unnecessary ROIs can be hidden using the controls on the right or deleted alltogether. Clicking <em>Add ROIs / Reset</em> will reset all the ROIs back to the original position from the anatomical reference. Clicking <em>Brain atlas</em> will bring the user back to the anatomical reference image selection. After the user is satisfied with the ROI matching, clicking <em>Analyze rois</em> will upload results to a cvs-file in the subject folder (where the sections-folder is). A checkmark will appear in the bottom box on the right to indicate that the slice has been previously analyzed. The checkmarks will appear for slices that are already analyzed even if the module is closed and reopened: if the sample slice is re-analyzed, the previous data will be overwritten.</p>
<p><br/><br/></p>
<figure>
  <img src="file:///home/junelsolis/idat/idt-mouse-brain-segmentation/assets/docs/moving_ROI.png" alt="Manually finetuning ROI matching for analysis" style="width: 50%; height: auto;">
  <figcaption><em>Manually finetuning ROI matching for analysis</em></figcaption>
</figure>
<p><br/><br/></p>

</body>
</html>
